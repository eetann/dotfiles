---
name: design_creator
description: spec DDで要件定義を元に設計書を作る
---

## 設計書の例

````markdown
# [一言説明] 設計書

## アーキテクチャ概要

### 実装方針
- 既存の`/api/routes/foo`に新規エンドポイントを追加

### ライブラリ
- **日付処理**: moment.js（既存）
- **データベースクエリ**: Mongoose（既存）

## エンドポイント詳細設計

### ルート定義
```javascript
router.get('/download', async function(req, res) { /* ... */ });
```
- メソッド: GET
- パス: `/foo/download`
- 認証: 既存の認証ミドルウェアを使用（他のエンドポイントと同様）

### リクエストバリデーション
```typescript
// 必須パラメータのチェック
if (req.query.book_id) {
  // 
} else {
  return res.json({ error: 'パラメータ不足' });
}
```

### データ取得クエリ
```typescript
const foo = await Foo.find({
  '$and': [
    { book_id: req.query.book_id },
  ]
})
.sort({ createdAt: 'desc' })
```
- 注意: `text`フィールドはFooモデルの直接のフィールドなので、自動的に取得される


## データフロー設計

### 処理の流れ
1. **リクエスト受信**
   - クエリパラメータから`book_id`を取得

2. **バリデーション**
   - 必須パラメータの存在確認
   - 不足がある場合はエラーレスポンスを返却

3. **データベースクエリ実行**
   - MongoDBから該当期間のログを取得
   - createdAtの降順でソート
   - 関連データをpopulate

4. **レスポンス生成**
   - JSON形式でログデータを返却


## エラーハンドリング設計

### 想定されるエラーケース

| エラー種別 | 原因 | 対応 |
|----------|------|------|
| パラメータ不足 | 必須パラメータが未指定 | `{ error: 'パラメータ不足' }` を返却 |
| データベースエラー | MongoDB接続エラー等 | catchブロックでエラーログ出力、500エラー |

### エラー処理実装
```typescript
try {
  // メイン処理
} catch (e) {
  console.info(e);
  throw Error(e);
}
```


## テスト戦略
<!-- 既存のテストで参考になりそうなやつがあれば書く -->

### ユニットテスト
- [ユニットテストアプローチ]
- [テストすべき主要コンポーネント]

### 統合テスト
- [統合テストアプローチ]
- [テストすべき主要フロー]

### エンドツーエンドテスト
- [E2Eテストアプローチ]
- [テストすべきユーザーシナリオ]


## やらないこと
あれば書く
````

## 指示
次の順に従ってください。`YYYY-MM-DD-BRIEF-DESC`の部分は事前に指示されます。

- `./.mywork/specs/YYYY-MM-DD-BRIEF-DESC/requirements.md`を読み込む
- 要件定義に基づき、コードをリサーチして上記の例のような設計書を `./.mywork/specs/YYYY-MM-DD-BRIEF-DESC/design.md` として書く

補足：
- 開発者にとって分かりやすくなるなら、例のテンプレートは多少改変しても構わない
    - セキュリティやパフォーマンスに関する考慮事項を書くなど
- 既存のコードを閲覧し、再利用可能な関数があれば使うこと
- 実装・修正箇所の行番号はなるべく書かない。ファイルを編集すると行番号はズレるため
- 実装の詳細は基本的に書かない
    - 長くなって読みづらくなってしまうため
    - 実装はコメントとして書けばスッキリして俯瞰的に見やすい
    - バグ修正などの場合は詳細に書いてもよい
