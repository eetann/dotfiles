---
name: design_creator
description: spec DDで要件定義を元に設計書を作る
---

## 設計書の例

````markdown
# [一言説明] 設計書

## 1 アーキテクチャ概要

### 1.1 実装方針
- 既存の`/api/routes/foo`に新規エンドポイントを追加

### 1.2 ライブラリ
- **日付処理**: moment.js（既存プロジェクトで使用中）
- **データベースクエリ**: Mongoose（既存のORM）

## 2. エンドポイント詳細設計

### 2.1 ルート定義
```javascript
router.get('/download', async function(req, res) { /* ... */ });
```
- メソッド: GET
- パス: `/foo/download`
- 認証: 既存の認証ミドルウェアを使用（他のエンドポイントと同様）

### 2.2 リクエストバリデーション
```typescript
// 必須パラメータのチェック
if (req.query.book_id) {
  // 
} else {
  return res.json({ error: 'パラメータ不足' });
}
```

### 2.3 データ取得クエリ
```typescript
const foo = await Foo.find({
  '$and': [
    { book_id: req.query.book_id },
  ]
})
.sort({ createdAt: 'desc' })
```
- 注意: `text`フィールドはFooモデルの直接のフィールドなので、自動的に取得される


## 3. データフロー設計

### 3.1 処理の流れ
1. **リクエスト受信**
   - クエリパラメータから`book_id`を取得

2. **バリデーション**
   - 必須パラメータの存在確認
   - 不足がある場合はエラーレスポンスを返却

3. **データベースクエリ実行**
   - MongoDBから該当期間のログを取得
   - createdAtの降順でソート
   - 関連データをpopulate

4. **レスポンス生成**
   - JSON形式でログデータを返却


## 4. エラーハンドリング設計

### 4.1 想定されるエラーケース

| エラー種別 | 原因 | 対応 |
|----------|------|------|
| パラメータ不足 | 必須パラメータが未指定 | `{ error: 'パラメータ不足' }` を返却 |
| データベースエラー | MongoDB接続エラー等 | catchブロックでエラーログ出力、500エラー |

### 4.2 エラー処理実装
```typescript
try {
  // メイン処理
} catch (e) {
  console.info(e);
  throw Error(e);
}
```


## 5 テスト戦略
<!-- 既存のテストで参考になりそうなやつがあれば書く -->

### 5.1 ユニットテスト
- [ユニットテストアプローチ]
- [テストすべき主要コンポーネント]

### 5.2 統合テスト
- [統合テストアプローチ]
- [テストすべき主要フロー]

### 5.3 エンドツーエンドテスト
- [E2Eテストアプローチ]
- [テストすべきユーザーシナリオ]

````

## 指示
次の順に従ってください。`YYYY-MM-DD-BRIEF-DESC`の部分は事前に指示されます。

- `./.codex/specs/YYYY-MM-DD-BRIEF-DESC/requirements.md`を読み込む
- 要件定義に基づき、コードをリサーチして上記の例のような設計書を `./.codex/specs/YYYY-MM-DD-BRIEF-DESC/design.md` として書く

補足：
- 開発者にとって分かりやすくなるなら、例のテンプレートは多少改変しても構わない
    - セキュリティやパフォーマンスに関する考慮事項を書くなど
- 既存のコードを閲覧し、再利用可能な関数があれば使うこと
