[[plugins]] # コメントアウトに便利
repo = 'tyru/caw.vim'
on_map = ['<Plug>(caw:']
hook_add = '''
    let g:caw_dollarpos_sp_left=' '
    " TODO: コメントアウト時にカーソル位置を移動しない
    nmap gc     <Plug>(caw:prefix)
    xmap gc     <Plug>(caw:prefix)
    nmap gcc    <Plug>(caw:hatpos:toggle)
    xmap gcc    <Plug>(caw:hatpos:toggle)
    nmap gci    <Plug>(caw:hatpos:comment)
    nmap gcui   <Plug>(caw:hatpos:uncomment)
    nmap gcI    <Plug>(caw:zeropos:comment)
    nmap gcuI   <Plug>(caw:zeropos:uncomment)
    nmap gca    <Plug>(caw:dollarpos:comment)
    nmap gcua   <Plug>(caw:dollarpos:uncomment)
    xmap gcb    <Plug>(caw:box:comment)
    nmap gco    <Plug>(caw:jump:comment-next)
    nmap gcO    <Plug>(caw:jump:comment-prev)
    nmap gct    <Plug>(caw:jump:comment-next)TODO:<Space>
    nmap gcT    <Plug>(caw:jump:comment-prev)TODO:<Space>
    nnoremap gcl :vimgrep /TODO:/j %<CR>
'''

[[plugins]] # プレビューをブラウザで開く
repo = 'tyru/open-browser.vim'
on_map = ['<Plug>(openbrowser-smart-search)']
on_cmd = "OpenBrowser"
hook_add = '''
	autocmd vimrc BufNewFile,BufRead *.html,*.py nnoremap <buffer><Leader>p
		\ :execute "OpenBrowser http://localhost:8000/" . expand('%')<CR>
	autocmd vimrc BufNewFile,BufRead *.html,*.py nnoremap <buffer><Leader>cp
		\ :term ++rows=5 cmd.exe /c python server.py
	let g:netrw_nogx = 1 " disable netrw's gx mapping.
	nmap gx <Plug>(openbrowser-smart-search)
	vmap gx <Plug>(openbrowser-smart-search)
	function! My_opens()
		execute 'OpenBrowser ' . substitute(expand('%:p'), '\v/mnt/(.)', '\1:/', 'c')
	endfunction
'''

[[plugins]] # その場で実行できる
repo = 'thinca/vim-quickrun'
on_cmd = "QuickRun"
hook_add = '''
    set errorformat=%A\ \ File\ \"%f\"\\,\ line\ %l%.%#,%Z%[%^\ ]%\\@=%m
    let g:quickrun_config = {}
    let g:quickrun_config = {
        \ "_":{
        \ 'runner'    : 'job',
        \ 'runner/terminal/into':1,
        \ 'outputter' : 'quickfix',
        \ 'outputter/quickfix/into':1,
        \ 'outputter/error/success' : 'buffer',
        \ 'outputter/error/error'   : 'quickfix',
        \ 'outputter/buffer/close_on_empty' : 1,
        \ 'outputter/buffer/into':1,
        \ 'outputter/buffer/split'  :
        \ '%{winwidth(0) * 2 < winheight(0) * 5 ? winheight(0)/4 : "vertical"}',
        \ },
        \ 'markdown': {
        \ 'runner'    : 'vimscript',
        \ 'exec':'%c %a',
        \ 'command': ":call",
        \ 'args': 'My_opens()',
        \ 'outputter':'null',
        \ },
        \ 'html': {
        \ 'runner'    : 'vimscript',
        \ 'exec':'%c %a',
        \ 'command': ":call",
        \ 'args': 'My_opens()',
        \ 'outputter':'null',
        \ },
        \ 'matlab': {
        \ 'runner':"vimscript",
        \ 'exec':'%c %o',
        \ 'command': ':call',
        \ 'cmdopt': 'matlab#RunCurrentFile()'
        \ },
        \ 'tex': {
        \ 'command': 'latexmk',
        \ 'args':'-pvc',
        \ 'exec':'%c %s %a',
        \ },
        \ }
        "\ 'src': '%{system("wslpath -w %{expand(\"%:p\")}")}',
    " qでquickfixを閉じる
    autocmd vimrc FileType qf nnoremap <silent><buffer>q :quit<CR>
    " normal or visual modeのとき <leader> + r で保存してからquickrunの実行
    let g:quickrun_no_default_key_mappings = 1
    nnoremap <leader>r :write<CR>:QuickRun -mode n<CR>
    nnoremap <leader>R :write<CR>:QuickRun -runner terminal<CR>
    xnoremap <leader>r :<C-U>write<CR>gv:QuickRun -mode v<CR>
    " <C-c> でquickrunを停止
    nnoremap <expr><silent> <C-c> quickrun#is_running() ? quickrun#sweep_sessions() : "\<C-c>"
'''


[[plugins]] # カラーコードの色表示
repo = 'ap/vim-css-color'
on_event = 'VimEnter'

[[plugins]] # undoを視覚的に
repo = 'sjl/gundo.vim'
on_cmd = 'GundoToggle'
hook_add = '''
    let g:gundo_prefer_python3 = 1
    nnoremap U :<C-u>GundoToggle<CR>
'''

[[plugins]] # 指定した文字で整形
repo = 'junegunn/vim-easy-align'
on_map = ['<Plug>(EasyAlign)']
hook_add = '''
    xmap ga <Plug>(EasyAlign)
    nmap ga <Plug>(EasyAlign)
    " コメントや文字列中でも有効化
    let g:easy_align_ignore_groups = []
'''

[[plugins]] # Camel _ のmotionを<leader>w b e geに対応
repo = 'bkad/CamelCaseMotion'
on_map = ['<Plug>CamelCaseMotion']
hook_add = '''
    map <silent> <leader>w <Plug>CamelCaseMotion_w
    map <silent> <leader>b <Plug>CamelCaseMotion_b
    map <silent> <leader>e <Plug>CamelCaseMotion_e
    map <silent> <leader>ge <Plug>CamelCaseMotion_ge
'''

[[plugins]] # 適切なカーソルラインのハイライト
repo = 'delphinus/vim-auto-cursorline'
on_event = 'VimEnter'
hook_add = '''
    autocmd vimrc FileType defx :let b:auto_cursorline_disabled = 1
'''

[[plugins]]
repo = 'skanehira/translate.vim'
on_cmd = ['Translate','AutoTranslateModeEnable',
'AutoTranslateModeDisable','AutoTranslateModeToggle']

[[plugins]]
repo = 'junegunn/fzf'
build = './install --all'
merged = 0

[[plugins]]
repo = 'junegunn/fzf.vim'
on_event = 'VimEnter'
hook_add = '''
    command! -bang -nargs=? -complete=dir Files
    \ call fzf#vim#files(<q-args>, {'options':
    \ ['--layout=reverse', '--preview', 'cat {}']}, <bang>0)
    command! -bang Dotfiles
    \ call fzf#vim#files('~/dotfiles',
    \ {'source':'find . -type f -not -path "*/\.git/*" | sed "s/^\.\///"'}, <bang>0)
    nnoremap <F6> :Dotfiles<CR>
'''

[[plugins]] # マーク位置の表示
repo = 'kshenoy/vim-signature'
on_event = 'VimEnter'

[[plugins]]
repo = '~/.vim/my_plugins/foldppp'
on_cmd = 'Foldppp'
on_map = '<Plug>(foldppp-show)'
hook_add = '''
    nmap <leader>s <Plug>(foldppp-show)
'''

[[plugins]] # 日本語ヘルプ
repo = 'vim-jp/vimdoc-ja'
on_ft = ['help']

[[plugins]]
repo = 'simeji/winresizer'
on_event = 'WinEnter'
on_if = 'winnr("$") > 1'
hook_post_source = '''
    " リサイズ幅を1ずつに変更
    let g:winrisizer_vert_resize=1
    let g:winresizer_horiz_resize=1
'''

[[plugins]] # file explorer
repo = 'Shougo/defx.nvim'
depends = ['nvim-yarp', 'vim-hug-neovim-rpc','defx-icons']
on_cmd = 'Defx'
hook_add = '''
    " windowが編集ファイル以外だけになったら違うバッファへ
    autocmd vimrc WinEnter * call s:move_buffer_for_defx()
    function! s:move_buffer_for_defx() abort
        if &ft == 'defx' && winnr('$') == 1
            q
            bprevious
            let s:win_id = win_getid()
            Defx -split=vertical -columns=indent:filename:type
            \ -winwidth=30  -direction=topleft
            let succeed = win_gotoid(s:win_id)
            " TODO: bufnrだと、隠しバッファ状態でも検知してしまう
            " TODO: defxではなくTagbarで2つの状態のときも検知したい
        elseif winnr('$') == 2 && &ft == 'defx' && bufnr('Tagbar')!=-1
            q
            TagbarClose
            bprevious
            let s:win_id = win_getid()
            Defx -split=vertical -columns=indent:filename:type
            \ -winwidth=30  -direction=topleft
            TagbarOpen
            let succeed = win_gotoid(s:win_id)
        elseif &ft == 'Tagbar' && winnr('$') == 1
            TagbarClose
            bprevious
            TagbarOpen
        end
    endfunction
    nnoremap <silent> <Space>f
    \ :<C-u>Defx -split=vertical -columns=indent:filename:type
        \ -winwidth=30 -direction=topleft -toggle<CR>
'''
hook_source = '''
    autocmd FileType defx call s:defx_my_settings()
    function! s:defx_my_settings() abort
        nnoremap <silent><buffer><expr> <CR>
        \ defx#is_directory() ?
            \ defx#do_action('open_or_close_tree') :
            \ defx#do_action('drop')
        nnoremap <silent><buffer><expr> o
        \ defx#do_action('open')
        nnoremap <silent><buffer><expr> l
        \ defx#is_opened_tree() ?
            \ defx#do_action('open') :
            \ defx#is_directory() ?
                \ defx#do_action('open_tree') :
                \ ((&columns > 150) ?
                    \ defx#do_action('drop'):
                    \ defx#do_action('multi', ['drop', 'quit']))
        nnoremap <silent><buffer><expr> L
        \ defx#is_directory() ?
            \ defx#do_action('open') :
            \ defx#do_action('drop')
        nnoremap <silent><buffer><expr> sb
        \ defx#do_action('multi', [['drop', 'split'], 'quit'])
        nnoremap <silent><buffer><expr> sv
        \ defx#do_action('multi', [['drop', 'vsplit'], 'quit'])
        nnoremap <silent><buffer><expr> p
        \ defx#do_action('open', 'pedit')
        nnoremap <silent><buffer><expr> S
        \ defx#do_action('toggle_sort', 'extension')
        nnoremap <silent><buffer><expr> d
        \ defx#do_action('remove')
        nnoremap <silent><buffer><expr> r
        \ defx#do_action('rename')
        nnoremap <silent><buffer><expr> !
        \ defx#do_action('execute_command')
        nnoremap <silent><buffer><expr> x
        \ defx#do_action('execute_system')
        nnoremap <silent><buffer><expr> yy
        \ defx#do_action('yank_path')
        nnoremap <silent><buffer><expr> .
        \ defx#do_action('toggle_ignored_files')
        nnoremap <silent><buffer><expr> h
        \ defx#is_opened_tree() ?
            \ defx#do_action('close_tree') :
            \ defx#do_action('cd', ['..'])
        nnoremap <silent><buffer><expr> H
        \ defx#do_action('cd', ['..'])
        nnoremap <silent><buffer><expr> ~
        \ defx#do_action('cd')
        nnoremap <silent><buffer><expr> q
        \ defx#do_action('quit')
        nnoremap <silent><buffer><expr> <Space>
        \ defx#do_action('toggle_select') . 'j'
        nnoremap <silent><buffer><expr> *
        \ defx#do_action('toggle_select_all')
        nnoremap <silent><buffer><expr> j
        \ line('.') == line('$') ? 'gg' : 'j'
        nnoremap <silent><buffer><expr> k
        \ line('.') == 1 ? 'G' : 'k'
        nnoremap <silent><buffer><expr> <C-l>
        \ defx#do_action('redraw')
        nnoremap <silent><buffer><expr> <C-g>
        \ defx#do_action('print')
        nnoremap <silent><buffer><expr> cd
        \ defx#do_action('change_vim_cwd')
    endfunction
'''
